<html>

<head>
    <meta charset="utf-8">
    <title>${requirement.name}</title>
    <link rel="stylesheet" media="all" href="/css/mephi-style.css" data-turbolinks-track="true"/>
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon-32x32.png" sizes="32x32"/>
    <link rel="apple-touch-icon" type="image/x-icon" href="/img/apple-icon.png"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
</head>

<body>
<div id="navbar">
    <nav class='navbar navbar-inverse'>
        <div class='container-fluid'>
            <div class='navbar-header'>
                <a class="navbar-brand" href="/"><i class="fa fa-home"></i> Home</a>
                <#if isAdmin>
                <a class="navbar-brand" href="/admin"><i class="fa fa-lock"></i> Admin panel </a>
            </#if>
        </div>
        <div class='navbar-right'>
            <a class="navbar-brand" href="/logout"><i class="fa fa-sign-out"></i>Log out</a>
        </div>
</div>
</nav>
</div>

<div class='container'>
    <div class='row'>
        <div class='login'>
            <div class='page-header'>
                <h2 class='text-left'>${requirement.name}</h2>
                <a class="btn btn-primary" href="/edit_requirement?id=${requirement.id}">
                    <i title="Edit requirement" class="fa fa-pencil-square-o"></i>
                    Edit
                </a>

                <a class="btn btn-primary" href="/changeRequirementState?id=${requirement.id}">
                    <i title="Change status" class="fa fa-pencil-square-o"></i>
                    Change status
                </a>


                <button class="btn btn-primary" onclick="openDeleteRequirementDialog()">
                    Delete requirement
                </button>

                <dialog id="DeleteRequirementDialog">
                    <h3 class="text-left"> Delete requirement </h3>
                    Are you sure?
                    <br/><br/>
                    <button class="btn btn-primary"
                            onclick="yesDeleteRequirement(${requirement.id})">
                        yes
                    </button>
                    <button class="btn btn-primary" onclick="cancelDeleteRequirement()">cancel</button>

                </dialog>

                <script>
                    function openDeleteRequirementDialog() {
                        (document.getElementById("DeleteRequirementDialog")).open = true;
                    }

                    function cancelDeleteRequirement() {
                        (document.getElementById("DeleteRequirementDialog")).close();
                    }

                    function yesDeleteRequirement(requirementId) {
                        (document.getElementById("DeleteRequirementDialog")).close();
                        let hrefProjectPage = "/project?id=${requirement.projectId}";
                        let xhr = new XMLHttpRequest();
                        let json = JSON.stringify({
                            id: requirementId,
                        });

                        let URL = "http://localhost:8080/requirements/";
                        xhr.open("POST", 'deleteRequirement', true);
                        xhr.setRequestHeader(requirementId, 'application/json; charset=utf-8');

                        console.log("I want to send json " + json);
                        // xhr.send(json);

                        window.location.href = hrefProjectPage;
                    }
                </script>

                <br><br>
                <a class="btn btn-primary" href="/new_testCase?requirementId=${requirement.id}">
                    <i title="Create test-case" class="fa fa-plus"></i>
                    Create test-case
                </a>

                <a class="btn btn-primary" href="/addTestCaseToReq?requirementId=${requirement.id}">
                    <i title="Add test-case" class="fa fa-plus"></i>
                    Add test-case
                </a>
                <br>

            </div>


            <h3 class="text-left">Description</h3>
            <div style="font-size: medium">
                ${requirement.description}
            </div>

            <h3 class="text-left"> Priority </h3>
            <div style="font-size: medium">
                ${priority.name}
            </div>

            <h3 class="text-left"> State </h3>
            <div style="font-size: medium">
                ${state.name}
            </div>

            <h3 class="text-left"> Type </h3>
            <div style="font-size: medium">
                ${type.name}
            </div>

            <h3 class="text-left"> Relevance </h3>
            <div style="font-size: medium">
                ${requirement.getRelevance()}
            </div>

            <h3 class="text-left"> Created Date </h3>
            <div style="font-size: medium">
                ${requirement.creationDate} by ${creator.getLogin()}
            </div>

            <h3 class="text-left"> Modified Date </h3>
            <div style="font-size: medium">
                ${requirement.modifiedDate} by ${changer.getLogin()}
            </div>

            <h3 class="text-left">Dependent requirements</h3>
            <div style="font-size: medium">
                <#list dependedRequirements>
                <table width="100%">
                    <div class='col-sm-2'>
                        <div class='list-group'>
                            <#items as dependedRequirement>
                            <tr>
                                <td width="5%">
                                    <div class="list-group-item text-center">
                                        ${dependedRequirement?counter}
                                    </div>
                                </td>
                                <td><a class="list-group-item text-center"
                                       href="/dependedRequirement?id=${dependedRequirement.id}">${dependedRequirement.name}</a>
                                </td>
                            </tr>
                            </#items>
                        </div>
                    </div>
                </table>
                </#list>
            </div>


            <h3 class="text-left">Test-cases</h3>
            <div style="font-size: medium">
                <#list testCases>
                <table width="100%">
                    <div class='col-sm-2'>
                        <div class='list-group'>
                            <#items as testCase>
                            <tr>
                                <td width="5%">
                                    <div class="list-group-item text-center">
                                        ${testCase?counter}
                                    </div>
                                </td>
                                <td><a class="list-group-item text-center"
                                       href="/testCase?id=${testCase.id}">${testCase.name}</a>
                                </td>
                            </tr>
                            </#items>
                        </div>
                    </div>
                </table>
                </#list>
            </div>

    <br>
</div>
<footer class='text-muted'>
    <div class='pull-left'><span>2018</span></div>
    <div class='clearfix'></div>
</footer>
</div>
</div>
</body>
</HTML>